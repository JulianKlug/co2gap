### 2025-12
- Confirmed MIMIC-III gz files live at `/mnt/hdd1/datasets/mimiciii_1.4` (read-only) and that the `co2gap` conda env is active for all work.
- Wrote `docs/cardiac_swan_cohort.md` detailing the Postgres build steps plus the ICD-9 + PA-catheter logic needed for the cohort.
- Enumerated the exact ICD-9 ranges/item IDs for cardiac surgery admissions and Swan-Ganz use; captured the executable SQL in `sql/cardiac_swan_cohort.sql`.
- Verified PostgreSQL access via the `postgres` role/password stored in `~/.pgpass`; noted the libc collation mismatch warning that can be fixed later with `ALTER DATABASE ... REFRESH COLLATION VERSION` after rebuilds.
- Ran the cohort SQL over the loaded `mimic` DB: 6,272 ICU stays (6,196 hadm_id / 6,113 subjects) meet the cardiac-surgery + PA-catheter criteria; spot-checked the earliest admissions to confirm CSRU provenance.
- Addressed the libc collation mismatch by running `ALTER DATABASE ... REFRESH COLLATION VERSION` on both `mimic` and `postgres`; confirmed the warning disappears on reconnect.
- Refined the SQL to anchor each ICU stay to the earliest `CSURG` service transfer (fallback to ICU intime) and require PA-catheter documentation between surgery day (day 0) and day 30; refreshed docs to explain the assumption and reran the cohort, now yielding 6,198 ICU stays (6,148 hadm_id / 6,067 subjects).
- Added `sql/cardiac_swan_cohort_explained.md` to document each CTE/step in the refined SQL so future updates are easier to audit.
- Replaced the surgery-day anchor with a dual approach: earliest OR-related `procedureevents_mv` timestamp when available, otherwise the first transfer into CSRU (for cardiac-coded admissions). Reran the cohort query, now totaling 6,207 ICU stays (6,156 hadm_id / 6,074 subjects) under the day 0-30 rule.
- Built a temp cohort table in Postgres and exported four CSV extracts under `output/`: demographics (6,272 rows), surgery ICD details (38,851 rows), blood gases within day 0-30 (~1.0M rows), and Swan-Ganz-derived measures (~1.36M rows). Each record carries subject/hadm/icustay IDs plus timestamps; blood gases include specimen info and Swan metrics capture PAP/SvO2/cardiac output signals.
- Re-extracted the blood gas CSV with a new `specimen_type` column by joining the accompanying SPECIMEN TYPE lab rows (itemids 50800/50801) so arterial/venous distinctions are preserved alongside the original fluid label.
- Saved the full Postgres extraction workflow (cohort temp tables + CSV exports, including specimen_type join) in `sql/extract_cardiac_swan_outputs.sql` so the outputs can be regenerated reproducibly with `psql -f`.
- Renamed the extraction script to `sql/extract_data.sql` for clarity.
- Added `sql/extract_data_explained.md` to describe each temp-table/export step (cohort build, demographics, surgery ICDs, blood gases with specimen type, Swan-Ganz measures) so the pipeline is easy to follow.
- Created `README.md` summarizing prerequisites, database build instructions, cohort documentation, extraction steps (`sql/extract_data.sql`), and troubleshooting tips so the entire workflow can be reproduced end-to-end.
- Added `docs/data_dictionary.md` describing every column in the exported CSVs (demographics, surgery ICDs, blood gases with specimen_type, Swan-Ganz measures) and their original MIMIC source tables/derivations.
- Added a dedicated "Surgery time derivation" section to `docs/cardiac_swan_cohort.md` describing the OR procedureevents → CSRU transfer → ICU intime fallback hierarchy used to anchor day 0.
- Extended `sql/extract_data.sql`/`sql/extract_data_explained.md`/`README.md`/`docs/data_dictionary.md` to capture hemoglobin (blood-gas + hematology labs) and temperature (blood-gas labs + charted temperatures) in a new CSV `output/cardiac_swan_hemoglobin_temperature.csv`.
- Reran `sql/extract_data.sql` (with a longer timeout) to regenerate all five CSVs, including the new hemoglobin+temperature extract for 746,099 measurement rows.
- Added `scripts/build_matched_measurements.py` plus documentation (README/data_dictionary) and ran it to produce `output/cardiac_swan_matched_measurements.csv` (79,307 rows) that aligns hemoglobin, blood gas, Swan-Ganz, and temperature measurements within ±30 minutes of arterial/central blood-gas anchors.
- Modified `scripts/build_matched_measurements.py` to anchor on cardiac output timestamps (rather than blood gases) and expose per-measurement tolerance CLI args; regenerated `output/cardiac_swan_matched_measurements.csv` (59,394 rows) with the new logic and documented the script usage/outputs in README/data_dictionary.
- Updated `scripts/build_matched_measurements.py` defaults to ±15 min for blood gases & cardiac index, ±720 min for hemoglobin, ±30 min for temperature; reran it to rebuild `output/cardiac_swan_matched_measurements.csv` with the new windows.
- Added `--include-venous/--no-include-venous` flag to `scripts/build_matched_measurements.py` (default True) so `VEN` specimens are considered arterial; rebuilt the matched CSV with the new default windows (arterial sat now 1,296/59,394 anchors, hemoglobin 58,105/59,394, etc.).
- Adjusted `scripts/build_matched_measurements.py` so the `--include-venous` flag routes `VEN` specimens into the central-venous bucket (default true) and regenerated the matched CSV (59,394 rows; central saturation now available for 7 anchors).
